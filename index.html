<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>CryptoZombies front-end</title>
    <!--<script src="https://unpkg.com/@metamask/legacy-web3@latest/dist/metamask.web3.min.js"></script>-->
    <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="web3.min.js"></script>
    <script language="javascript" type="text/javascript" src="cbgameplay_abi.js"></script>
    <script language="javascript" type="text/javascript" src="constants.js"></script>

  </head>
  <body>

    <script>

      import { CLIENT_EVENTS } from "@walletconnect/client";
      import { PairingTypes, SessioTypes } from "@walletconnect/types";

      var cyrptoBladesGP;
      var walletAdd = "0x50F0CaA444E5F033ec61A39BcB735eb957cbFa31";

      function startApp() {
        //var cryptoBladesGPAddress = "0x39Bea96e13453Ed52A734B6ACEeD4c41F57B2271";
        //var cryptoBladesGPAddress = "0x34f7D2a38711F3aed475708AF4dd03B3deE6b02E";
        cyrptoBladesGP = new web3js.eth.Contract(cbgameplayABI, conAddress.oec.cryptoBlades);

        // getTest(walletAdd)
        //   .then(function(result) {
        //     //alert(result);
        //     //$('#test').text(result);
        //     console.log("Zombie 15: " + JSON.stringify(result));
        // });
        //cyrptoBladesGP.methods.fight(832607, 4458889, 0, 5).send();

      };

      function connect(){
        ethereum.request({ method: 'eth_requestAccounts' });
      }

      function fightOEClight() {
        //alert('fight');
        // const accounts = ethereum.request({ method: 'eth_accounts' })
        //   .then(function(result){
        //     return cyrptoBladesGP.methods.fight(oecChars.lightning.a, oecChars.lightning.weapon, $('#oecl1target')[0].value, oecChars.lightning.stamMult).send({ from: result[0] });
        //   });

        //var userAccount = web3.eth.accounts[0];

        //return cyrptoBladesGP.methods.fight(oecChars.lightning.a, oecChars.lightning.weapon, $('#oecl1target')[0].value, oecChars.lightning.stamMult).send({ from: ethereum.selectedAddress });
        const weiValue = Web3.utils.toWei('.1', 'gwei');

        if ($('#oecl1target1')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.lightning.a, oecChars.lightning.weapon, $('#oecl1target1')[0].value, oecChars.lightning.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target2')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.lightning.b, oecChars.lightning.weapon, $('#oecl1target2')[0].value, oecChars.lightning.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target3')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.lightning.c, oecChars.lightning.weapon, $('#oecl1target3')[0].value, oecChars.lightning.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target4')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.lightning.d, oecChars.lightning.weapon, $('#oecl1target4')[0].value, oecChars.lightning.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
     };

      function fightOECearth(){
        const weiValue = Web3.utils.toWei('.1', 'gwei');

        if ($('#oecl1target1')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.earth.a, oecChars.earth.weapon, $('#oecl1target1')[0].value, oecChars.earth.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target2')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.earth.b, oecChars.earth.weapon, $('#oecl1target2')[0].value, oecChars.earth.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target3')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.earth.c, oecChars.earth.weapon, $('#oecl1target3')[0].value, oecChars.earth.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target4')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.earth.d, oecChars.earth.weapon, $('#oecl1target4')[0].value, oecChars.earth.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
      }

      function fightOECfire() {
        const weiValue = Web3.utils.toWei('.1', 'gwei');

        if ($('#oecl1target1')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.fire.a, oecChars.fire.weapon, $('#oecl1target1')[0].value, oecChars.fire.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target2')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.fire.b, oecChars.fire.weapon, $('#oecl1target2')[0].value, oecChars.fire.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target3')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.fire.c, oecChars.fire.weapon, $('#oecl1target3')[0].value, oecChars.fire.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target4')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.fire.d, oecChars.fire.weapon, $('#oecl1target4')[0].value, oecChars.fire.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
      };      


      function fightOECwater() {
        const weiValue = Web3.utils.toWei('.1', 'gwei');

        if ($('#oecl1target1')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.water.a, oecChars.water.weapon, $('#oecl1target1')[0].value, oecChars.water.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target2')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.water.b, oecChars.water.weapon, $('#oecl1target2')[0].value, oecChars.water.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target3')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.water.c, oecChars.water.weapon, $('#oecl1target3')[0].value, oecChars.water.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
        if ($('#oecl1target4')[0].value != '') cyrptoBladesGP.methods.fight(oecChars.water.d, oecChars.water.weapon, $('#oecl1target4')[0].value, oecChars.water.stamMult).send(
          { from: ethereum.selectedAddress, gasPrice: weiValue });
      };      

      function fight(char, weap, target){


      };

      // Call the function and do something with the result:
      //getZombieDetails(15)
   

      window.addEventListener('load', function() {

        // Checking if Web3 has been injected by the browser (Mist/MetaMask)
        if (typeof web3 !== 'undefined') {
          // Use Mist/MetaMask's provider
          
          web3js = new Web3(web3.currentProvider);

        } else {
          // Handle the case where the user doesn't have Metamask installed
          // Probably show them a message prompting them to install Metamask
        }

        // Now you can start your app & access web3 freely:
        startApp();

      });
    </script>

  <div id="test">
    <input type="text" id="oecl1target1">
    <input type="text" id="oecl1target2">
    <input type="text" id="oecl1target3">
    <input type="text" id="oecl1target4">
    <button type="button" onclick="fightOEClight()">OEC-L</button>
    <button type="button" onclick="fightOECearth()">OEC-E</button>
    <button type="button" onclick="fightOECfire()">OEC-F</button>
    <button type="button" onclick="fightOECwater()">OEC-W</button>
    <button type="button" onclick="connect()">Connect</button>
  </div>
  </body>
</html>